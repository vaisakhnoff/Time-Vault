<style>
	.p_icon form,
.p_icon a {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 40px;
    height: 40px;
    background: #fff;
    border-radius: 50%; /* Ensures a perfect circle */
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    color: #222;
    transition: transform 0.3s, background 0.3s;
    text-decoration: none;
    border: none;
    overflow: hidden; /* Prevents any overflow if an image was present */
}

.p_icon form:hover button,
.p_icon a:hover {
    background: #ff0000;
    color: #fff;
    transform: scale(1.1);
}

.p_icon form button {
    position: relative;
    z-index: 3;
    background: none;
    border: none;
    width: 100%;
    height: 100%;
    padding: 0;
    cursor: pointer;
    color: inherit;
    font-size: 18px; /* Increase icon size for visibility */
}

.p_icon form button .ti-shopping-cart {
    transition: color 0.3s ease;
}
		.single-product {
			margin-bottom: 30px;
			transition: all 0.3s;
		}

		.product-img {
			position: relative;
			overflow: hidden;
			background: #f8f8f8;
			border: 1px solid #eee;
		}

		.product-img img {
			width: 100%;
			height: 255px;
			object-fit: cover;
			background-color: #f8f8f8; /* Fallback color if image fails to load */
		}

		.p_icon {
			position: absolute;
			bottom: -10px;
			left: 0;
			right: 0;
			display: flex;
			justify-content: center;
			align-items: center;
			gap: 15px;
			opacity: 0;
			transition: all 0.3s ease;
		}

		

		

		.single-product:hover .p_icon {
			bottom: 30px;
			opacity: 1;
		}

		.product-btm {
			padding: 15px;
			text-align: center;
		}

		.product-btm h4 {
			margin-bottom: 10px;
			font-size: 16px;
			color: #222;
		}

		.product-btm .mt-3 span {
			font-size: 18px;
			font-weight: 600;
			color: #222;
		}

		.product-btm .mt-3 del {
			font-size: 14px;
			color: #777;
			margin-left: 10px;
		}
		

		.single-product {
			cursor: pointer;
			transition: transform 0.3s ease;
		}

		.single-product:hover {
			transform: translateY(-5px);
		}

		.p_icon {
			z-index: 2;
		}

		.p_icon a {
			position: relative;
			z-index: 3;
		}

		.sidebar-categories {
			background: #fff;
			padding: 20px;
			border-radius: 4px;
			box-shadow: 0 2px 15px rgba(0,0,0,0.1);
		}

		.sidebar-categories .head {
			font-size: 18px;
			font-weight: 600;
			margin-bottom: 20px;
			padding-bottom: 10px;
			border-bottom: 2px solid #f0f0f0;
		}

		.filter-title {
			font-size: 16px;
			font-weight: 500;
			margin-bottom: 15px;
			color: #333;
		}

		.filter-section {
			padding: 15px 0;
			border-bottom: 1px solid #f0f0f0;
		}

		.sorting-options, .category-options {
			display: flex;
			flex-direction: column;
			gap: 10px;
		}

		.custom-control {
			padding-left: 30px;
		}

		.custom-control-label {
			cursor: pointer;
			font-size: 14px;
			color: #666;
		}

		.custom-control-input:checked ~ .custom-control-label {
			color: #222;
			font-weight: 500;
		}

		.price-range-inputs input {
			width: 80px;
			padding: 5px;
		}

		.search-box input {
			padding: 8px;
			border: 1px solid #ddd;
			border-radius: 4px;
		}

		.filter-actions {
			margin-top: 20px;
			padding-top: 20px;
			border-top: 1px solid #f0f0f0;
		}

		.btn-primary {
			background: #fbd600;
			border-color: #fbd600;
			color: #fff;
		}

		.btn-secondary {
			background: #f8f9fa;
			border-color: #ddd;
			color: #666;
		}
	</style>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body id="category">

	

	<!-- Start Banner Area -->
	<section class="banner-area organic-breadcrumb">
		<div class="container">
			<div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
				<div class="col-first">
					<h1>Shop Category page</h1>
					<nav class="d-flex align-items-center">
						<a href="/">Home<span class="lnr lnr-arrow-right"></span></a>
						<a href="#">Shop<span class="lnr lnr-arrow-right"></span></a>
						<a href="category.html">Fashon Category</a>
					</nav>
				</div>
			</div>
		</div>
	</section>

	<%- include("../../views/partials/user/header") %>

	<!-- End Banner Area -->
	<div class="container">
		<div class="row">
			<div class="col-xl-3 col-lg-4 col-md-5">
    <div class="sidebar-categories">
        <div class="head">Sort & Filter</div>
        <form id="filterForm" class="filter-form">
            <!-- Sort Options -->
            <div class="sorting-section mb-4">
                <h6 class="filter-title">Sort By</h6>
                <div class="sorting-options">
                    <div class="custom-control custom-radio">
                        <input type="radio" id="newest" name="sort" value="newest" 
                               class="custom-control-input" 
                               <%= sort === 'newest' ? 'checked' : '' %>>
                        <label class="custom-control-label" for="newest">Newest First</label>
                    </div>
                    <div class="custom-control custom-radio">
                        <input type="radio" id="price_asc" name="sort" value="price_asc" 
                               class="custom-control-input"
                               <%= sort === 'price_asc' ? 'checked' : '' %>>
                        <label class="custom-control-label" for="price_asc">Price: Low to High</label>
                    </div>
                    <div class="custom-control custom-radio">
                        <input type="radio" id="price_desc" name="sort" value="price_desc" 
                               class="custom-control-input"
                               <%= sort === 'price_desc' ? 'checked' : '' %>>
                        <label class="custom-control-label" for="price_desc">Price: High to Low</label>
                    </div>
                    <div class="custom-control custom-radio">
                        <input type="radio" id="name_asc" name="sort" value="name_asc" 
                               class="custom-control-input"
                               <%= sort === 'name_asc' ? 'checked' : '' %>>
                        <label class="custom-control-label" for="name_asc">Name: A to Z</label>
                    </div>
                    <div class="custom-control custom-radio">
                        <input type="radio" id="name_desc" name="sort" value="name_desc" 
                               class="custom-control-input"
                               <%= sort === 'name_desc' ? 'checked' : '' %>>
                        <label class="custom-control-label" for="name_desc">Name: Z to A</label>
                    </div>
                    <div class="custom-control custom-radio">
                        <input type="radio" id="brand_asc" name="sort" value="brand_asc" 
                               class="custom-control-input"
                               <%= sort === 'brand_asc' ? 'checked' : '' %>>
                        <label class="custom-control-label" for="brand_asc">Brand: A to Z</label>
                    </div>
                    <div class="custom-control custom-radio">
                        <input type="radio" id="brand_desc" name="sort" value="brand_desc" 
                               class="custom-control-input"
                               <%= sort === 'brand_desc' ? 'checked' : '' %>>
                        <label class="custom-control-label" for="brand_desc">Brand: Z to A</label>
                    </div>
                </div>
            </div>

            <!-- Category Filter -->
            <div class="filter-section mb-4">
                <h6 class="filter-title">Categories</h6>
                <div class="category-options">
                    <% categories.forEach(function(category) { %>
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" 
                                   class="custom-control-input" 
                                   id="category-<%= category._id %>" 
                                   name="category" 
                                   value="<%= category._id %>"
                                   <%= selectedCategory === category._id.toString() ? 'checked' : '' %>>
                            <label class="custom-control-label" 
                                   for="category-<%= category._id %>">
                                <%= category.name %>
                            </label>
                        </div>
                    <% }); %>
                </div>
            </div>

            <!-- Add this after the Categories filter section -->
            <div class="filter-section mb-4">
                <h6 class="filter-title">Brands</h6>
                <div class="brand-options">
                    <% brands.forEach(function(brand) { %>
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" 
                                   class="custom-control-input" 
                                   id="brand-<%= brand._id %>" 
                                   name="brand" 
                                   value="<%= brand._id %>"
                                   <%= selectedBrand === brand._id.toString() ? 'checked' : '' %>>
                            <label class="custom-control-label" 
                                   for="brand-<%= brand._id %>">
                                <%= brand.brandName %>
                            </label>
                        </div>
                    <% }); %>
                </div>
            </div>

            <!-- Price Range Filter -->
            <div class="filter-section mb-4">
                <h6 class="filter-title">Price Range</h6>
                <div class="price-range-inputs d-flex align-items-center">
                    <input type="number" 
                           class="form-control form-control-sm" 
                           name="minPrice" 
                           placeholder="Min" 
                           value="<%= minPrice %>"
                           min="0">
                    <span class="mx-2">-</span>
                    <input type="number" 
                           class="form-control form-control-sm" 
                           name="maxPrice" 
                           placeholder="Max" 
                           value="<%= maxPrice %>"
                           min="0">
                </div>
            </div>

            <!-- Search Box -->
            <div class="filter-section mb-4">
                <h6 class="filter-title">Search Products</h6>
                <div class="search-box">
                    <input type="text" 
                           class="form-control" 
                           name="search" 
                           placeholder="Search products..." 
                           value="<%= searchQuery %>">
                </div>
            </div>

            <!-- Filter Actions -->
            <div class="filter-actions">
                <button type="submit" class="btn btn-primary btn-block">Apply Filters</button>
                <button type="button" class="btn btn-secondary btn-block mt-2" onclick="clearFilters()">Clear All</button>
            </div>
        </form>
    </div>
</div>
			<div class="col-xl-9 col-lg-8 col-md-7">
				
				<!-- Start Best Seller -->
				<section class="lattest-product-area pb-40 category-list">
					<div class="row">
    <% if (products && products.length > 0) { %>
        <% products.forEach(function(product) { %>
            <div class="col-lg-4 col-md-6">
                <div class="single-product">
                    <a href="/productDetails?id=<%= product._id %>" class="product-link">
                        <div class="product-img">
                            <img class="img-fluid w-100" 
                                 src="<%= product.productImage[0] %>" 
                                 alt="<%= product.productName %>"
                                 onerror="this.src='/img/no-image.jpg'"
                                 style="height: 255px; object-fit: cover;">
								 <div class="p_icon">
									<!-- <form method="post" action="/add-to-cart/<%= product._id %>" onclick="event.stopPropagation();">
										<button type="submit" class="btn btn-cart">
											<i class="ti-shopping-cart"></i>
										</button>
									</form> -->

                                  <a href="#" onclick="event.preventDefault(); addToCart('<%= product._id %>')"> 
									<i class="ti-shopping-cart"></i>
								  </a>


									<a href="#" onclick="event.preventDefault(); addToWishlist('<%= product._id %>');">
										<i class="ti-heart"></i>
									</a>



								</div>
                        </div>
                        <div class="product-btm">
                            <h4><%= product.productName %></h4>
                            <p class="brand-name"><%= product.brand ? product.brand.brandName : 'No Brand' %></p>
                            <div class="mt-3">
                                <% if (product.salePrice && product.salePrice < product.regularPrice) { %>
                                    <span class="mr-4">₹<%= product.salePrice %></span>
                                    <del>₹<%= product.regularPrice %></del>
                                <% } else { %>
                                    <span>₹<%= product.regularPrice %></span>
                                <% } %>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        <% }); %>
    <% } else { %>
        <div class="col-12 text-center">
            <p>No products available.</p>
        </div>
    <% } %>
</div>

					<!-- Pagination -->
					<% if (totalPages > 1) { %>
						<div class="pagination-container mt-5">
							<div class="pagination">
								<% if (currentPage > 1) { %>
									<a href="?page=<%= currentPage - 1 %>" class="prev-arrow">
										<i class="fa fa-long-arrow-left"></i>
									</a>
								<% } %>

								<% for(let i = 1; i <= totalPages; i++) { %>
									<a href="?page=<%= i %>" 
									   class="<%= currentPage == i ? 'active' : '' %>">
										<%= i %>
									</a>
								<% } %>

								<% if (currentPage < totalPages) { %>
									<a href="?page=<%= currentPage + 1 %>" class="next-arrow">
										<i class="fa fa-long-arrow-right"></i>
									</a>
								<% } %>
							</div>
						</div>
					<% } %>
				</section>
				<!-- End Best Seller -->
				<!-- Start Filter Bar -->
				<div class="filter-bar d-flex flex-wrap align-items-center">
					<div class="sorting mr-auto">
						<select>
							<option value="1">Show 12</option>
							<option value="1">Show 12</option>
							<option value="1">Show 12</option>
						</select>
					</div>
					<div class="pagination">
						<a href="#" class="prev-arrow"><i class="fa fa-long-arrow-left" aria-hidden="true"></i></a>
						<a href="#" class="active">1</a>
						<a href="#">2</a>
						<a href="#">3</a>
						<a href="#" class="dot-dot"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></a>
						<a href="#">6</a>
						<a href="#" class="next-arrow"><i class="fa fa-long-arrow-right" aria-hidden="true"></i></a>
					</div>
				</div>
				<!-- End Filter Bar -->
			</div>
		</div>
	</div>

	

	

	<%-include("../../views/partials/user/footer")%>

	<script>
function clearSearch() {
    const form = document.getElementById('searchFilterForm');
    const searchInput = form.querySelector('input[name="search"]');
    searchInput.value = '';
    form.submit();
}

function applyPriceFilter() {
    const form = document.getElementById('searchFilterForm');
    const minPrice = document.querySelector('input[name="minPrice"]').value;
    const maxPrice = document.querySelector('input[name="maxPrice"]').value;
    
    // Create hidden inputs for price range
    const minInput = document.createElement('input');
    minInput.type = 'hidden';
    minInput.name = 'minPrice';
    minInput.value = minPrice;
    
    const maxInput = document.createElement('input');
    maxInput.type = 'hidden';
    maxInput.name = 'maxPrice';
    maxInput.value = maxPrice;
    
    form.appendChild(minInput);
    form.appendChild(maxInput);
    form.submit();
}


document.querySelectorAll('.pagination a').forEach(link => {
    link.addEventListener('click', (e) => {
        e.preventDefault();
        const params = new URLSearchParams(window.location.search);
        const newPage = new URLSearchParams(link.href.split('?')[1]).get('page');
        params.set('page', newPage);
        window.location.href = `${window.location.pathname}?${params.toString()}`;
    });
});

function clearFilters() {
    const form = document.getElementById('filterForm');
    form.reset();
    
    // Clear hidden inputs
    const hiddenInputs = form.querySelectorAll('input[type="hidden"]');
    hiddenInputs.forEach(input => input.remove());
    
    // Submit form to reset all filters
    form.submit();
}


document.getElementById('filterForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const params = new URLSearchParams();
    
    for (let [key, value] of formData.entries()) {
        if (value) {
            params.append(key, value);
        }
    }
    
    // Reset page number when applying new filters
    params.set('page', '1');
    
    window.location.href = `${window.location.pathname}?${params.toString()}`;
});


document.querySelectorAll('input[name="sort"]').forEach(radio => {
    radio.addEventListener('change', function() {
        document.getElementById('filterForm').submit();
    });
});


function addToWishlist(productId) {
    fetch('/addWishlist', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ id: productId }) // Make sure id is properly sent
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            Swal.fire("Success", data.message, "success");
        } else {
            Swal.fire("Alert", data.message, "warning");
        }
    })
    .catch(error => {
        Swal.fire("Error", "Something went wrong", "error");
    });
	
}
function addToCart(productId) {
    fetch('/addToCart', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ id: productId })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            Swal.fire("Success", data.message, "success");
        } else {
            Swal.fire("Alert", data.message, "warning");
        }
    })
    .catch(error => {
        Swal.fire("Error", "Something went wrong", "error");
    });
	
}

</script>

	<script src="js/vendor/jquery-2.2.4.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
	 crossorigin="anonymous"></script>
	<script src="js/vendor/bootstrap.min.js"></script>
	<script src="js/jquery.ajaxchimp.min.js"></script>
	<script src="js/jquery.nice-select.min.js"></script>
	<script src="js/jquery.sticky.js"></script>
	<script src="js/nouislider.min.js"></script>
	<script src="js/jquery.magnific-popup.min.js"></script>
	<script src="js/owl.carousel.min.js"></script>
	<!--gmaps Js-->
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCjCGmQ0Uq4exrzdcL6rvxywDDOvfAu6eE"></script>
	<script src="js/gmaps.min.js"></script>
	<script src="js/main.js"></script>
</body>

</html>